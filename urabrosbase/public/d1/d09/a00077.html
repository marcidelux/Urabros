<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urabros: D:/Projects/STM_Alapproject/repo/urabrosbase/Urabros/Master/Communication/uIncomingMessageHandler.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../urabrosLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Urabros
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_54f9a6d1bdbd16eff692e29bdfbc56b5.html">Urabros</a></li><li class="navelem"><a class="el" href="../../dir_f3b143f0978eeb510042af3dc2a8f547.html">Master</a></li><li class="navelem"><a class="el" href="../../dir_92a2a83bf00ded8e63718e7abf990171.html">Communication</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">uIncomingMessageHandler.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>IncomingMessageHandler is responsible for handling the incoming message queue.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../dd/d32/a00041_source.html">UrabrosTypeDef.h</a>&quot;</code><br />
</div>
<p><a href="../../d1/d09/a00077_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6492e2bc8cb6b730f9e44d21a83b2bb1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d32/a00041.html#aa63d87de17cd532fc1123b9b73cd9331">Urabros_StatusTypeDef</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d09/a00077.html#a6492e2bc8cb6b730f9e44d21a83b2bb1">uMsgInInit</a> ()</td></tr>
<tr class="memdesc:a6492e2bc8cb6b730f9e44d21a83b2bb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the incoming message queue.  <a href="../../d1/d09/a00077.html#a6492e2bc8cb6b730f9e44d21a83b2bb1">More...</a><br /></td></tr>
<tr class="separator:a6492e2bc8cb6b730f9e44d21a83b2bb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8faa419a50ced50e687bd0718cc0bd67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977">Urabros_MsgStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d09/a00077.html#a8faa419a50ced50e687bd0718cc0bd67">uMsgInPop</a> (<a class="el" href="../../dd/d32/a00041.html#a93968cd0dee053845b0b9bf883eb667b">Urabros_MsgPtr</a> uMsgPtr)</td></tr>
<tr class="memdesc:a8faa419a50ced50e687bd0718cc0bd67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pops the last message from the <a class="el" href="../../db/db6/a00074.html#afa1cb4af14f40dc64fe88a2307ed269b" title="Buffer for holding incoming messages.">uIncomingBuffer</a>.  <a href="../../d1/d09/a00077.html#a8faa419a50ced50e687bd0718cc0bd67">More...</a><br /></td></tr>
<tr class="separator:a8faa419a50ced50e687bd0718cc0bd67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e74e154b5e182274bd676a375bc98d5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977">Urabros_MsgStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d09/a00077.html#a6e74e154b5e182274bd676a375bc98d5">uMsgPutFromDMA</a> (void)</td></tr>
<tr class="memdesc:a6e74e154b5e182274bd676a375bc98d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Puts a message received by Uart to the incoming queue.  <a href="../../d1/d09/a00077.html#a6e74e154b5e182274bd676a375bc98d5">More...</a><br /></td></tr>
<tr class="separator:a6e74e154b5e182274bd676a375bc98d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a404a942de5861aa727ff404384fbf4c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d09/a00077.html#a404a942de5861aa727ff404384fbf4c6">uMsgInPrintBuffer</a> ()</td></tr>
<tr class="memdesc:a404a942de5861aa727ff404384fbf4c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">A debug function, prints all the element int the outgoing queue on human readeable format to debug line.  <a href="../../d1/d09/a00077.html#a404a942de5861aa727ff404384fbf4c6">More...</a><br /></td></tr>
<tr class="separator:a404a942de5861aa727ff404384fbf4c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>IncomingMessageHandler is responsible for handling the incoming message queue. </p>
<dl class="section author"><dt>Author</dt><dd>Marton.Lorinczi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Sep 14, 2020</dd></dl>
<pre class="fragment">    Uart currently works on DMA mode, there are a lot of different detection types for ensure secure communication.
    There is IDLE line detection, with this we dont have to count the number of bytes arriving and assembly the message,
    we just wait for the idle interrupt. That on;ly fires when a data transmission ended, after that happens we call the
    @see uMsgPutFromDMA() function, and it handles the rest.
    The Uart must be configured to DMA mode and enable global interrupt for it in CUBE MX
    Here is where and how to call the uMsgPutFromDMA function:
    stm32xxxx_it.c
    void USARTX_IRQHandler(void)
    {
        HAL_UART_IRQHandler(&amp;huart3);
        USER CODE BEGIN USART3_IRQn 1
        if (__HAL_UART_GET_FLAG(&amp;huart3,UART_FLAG_IDLE)){
        __HAL_UART_CLEAR_IDLEFLAG(&amp;huart3);
        if(uMsgPutFromDMA() != uMsg_Ok)  {}
    }
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a6492e2bc8cb6b730f9e44d21a83b2bb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6492e2bc8cb6b730f9e44d21a83b2bb1">&#9670;&nbsp;</a></span>uMsgInInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d32/a00041.html#aa63d87de17cd532fc1123b9b73cd9331">Urabros_StatusTypeDef</a> uMsgInInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the incoming message queue. </p>
<p>Sets IDLE line detection on. Starts the DMA receive function. </p><dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../dd/d32/a00041.html#aa63d87de17cd532fc1123b9b73cd9331ad052ea007e2975fee2c2085b3119cfa3" title="Function executed successfully.">uStatusOk</a> </dd></dl>

</div>
</div>
<a id="a8faa419a50ced50e687bd0718cc0bd67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8faa419a50ced50e687bd0718cc0bd67">&#9670;&nbsp;</a></span>uMsgInPop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977">Urabros_MsgStatus</a> uMsgInPop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d32/a00041.html#a93968cd0dee053845b0b9bf883eb667b">Urabros_MsgPtr</a>&#160;</td>
          <td class="paramname"><em>uMsgPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pops the last message from the <a class="el" href="../../db/db6/a00074.html#afa1cb4af14f40dc64fe88a2307ed269b" title="Buffer for holding incoming messages.">uIncomingBuffer</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uMsgPtr</td><td>This is a pointer to an <a class="el" href="../../d7/d12/a00126.html" title="Structure of an urabros message.">Urabros_Msg</a> variable.<br  />
 If the pop sucseeded than it will load the correct values to the pointer variable.<br  />
 If the queue was empty it will not make any modifications on the pointed variable. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977abbb789e89233849f41952b01d9887f7a" title="Everything went well.">uMsg_Ok</a> if it went well, returns <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977a568ff2be1a8cb4b94f44e064f67de165" title="This can describe many cases when a bugger is empty, see at:">uMsg_BufferIsEmpty</a> if the queue was empty </dd></dl>

</div>
</div>
<a id="a404a942de5861aa727ff404384fbf4c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a404a942de5861aa727ff404384fbf4c6">&#9670;&nbsp;</a></span>uMsgInPrintBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void uMsgInPrintBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A debug function, prints all the element int the outgoing queue on human readeable format to debug line. </p>

</div>
</div>
<a id="a6e74e154b5e182274bd676a375bc98d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e74e154b5e182274bd676a375bc98d5">&#9670;&nbsp;</a></span>uMsgPutFromDMA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977">Urabros_MsgStatus</a> uMsgPutFromDMA </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Puts a message received by Uart to the incoming queue. </p>
<pre class="fragment">    It makes different checks on the message, and depending on them it creates and puts a message to the queue:
    - If everything is ok than the received message is placed to the buffer
    - If Idle Error happend (The sending got interupted, and message broke appart)
    ---- data[0]: uCommand_RECEIVE_ERROR
    ---- data[1]: uMSg_IdleError
    - If Data len doesnt match:
    ---- data[0]: uCommand_RECEIVE_ERROR
    ---- data[1]: uMsg_DataLenError
    - If CRC is not correct:
    ---- data[0]: uCommand_RECEIVE_ERROR
    ---- data[1]: uMsg_CrcError
</pre> <dl class="section return"><dt>Returns</dt><dd>Depending on the process it returns, <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977abbb789e89233849f41952b01d9887f7a" title="Everything went well.">uMsg_Ok</a>, <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977a584533d2ccb790f44b0aeb14912f7348" title="If the transmittion broke while sending a message.">uMSg_IdleError</a>, <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977a97a5e39eecd96dddbd973668b25d31d4" title="If the first byte describing the lenght of message was wrong.">uMsg_DataLenError</a>, <a class="el" href="../../dd/d32/a00041.html#a33320981619ba0b123cb97d95ec35977aa2fc2405ea38d1a111e7dd65a9914369" title="If there was a crc misscalculation or data is corrupted, than this describes that state.">uMsg_CrcError</a> but theese are not needed to be handled in the interrupt. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
