<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Urabros: My Personal Index Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="urabrosLogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Urabros
   &#160;<span id="projectnumber">2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">My Personal Index Page </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>Urabros Framework created for STM32 MicroControllers. Owned by MechatroMotive Kft. <br  />
 This framework is wrapper for FreeRTOS system, giving us a lot usefull features. <br  />
 The main idea behind it is that there is a driver PC or MC what can start stop resume delete Tasks (we call it uTask). <br  />
 A task is responsible for a well described process. Forexample: An uTask for vending machine: Give me two minerall water bottles.</p>
<h1><a class="anchor" id="Arc_sec"></a>
Architecture</h1>
<p>There are some diagrams about the most important parts of the system. </p><hr  />
 <h2><a class="anchor" id="step1"></a>
BigPicture and other stuff</h2>
<p><img src="Urabros_MainSystem.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> <b>PC</b> - It is a computer but it can be an another Microcontroller too, the important thing itis the Master in this setup. <br  />
 It sends down urabros commands to the MC to start stop resume delete tasks. <br  />
 It gets urabros message or AXCII message from the MC <br  />
 <b>Urabros Master</b> - It is the main logic of the MC side. It is the bridge between uTasks and PC <br  />
 <b>uTask</b> - Abstraction layer for a well described process. <br  />
 <b>uDriver</b> - Driver handler for ensure multiple task could use singel hardware part without problem. </p><hr  />
 <h2><a class="anchor" id="step2"></a>
Master</h2>
<p><img src="Urabros_Master.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> See detailed informations at <a class="el" href="d9/d77/a00095.html" title="This header contains only one public function, what must be called in main.c  After all the other ini...">UrabrosMaster.h</a> and <a class="el" href="d1/dc1/a00092.html" title="Main logic part of the framework. There are four important parts of this source file.">UrabrosMaster.c</a> <br  />
 <b>Incoming Message Handler</b> <br  />
 found as <a class="el" href="d1/dc1/a00092.html#a2db873795fff7b1ed24eba9166f76aee" title="Thread function prototype for handling incoming commands from driving PC or MC.">urabrosCommunicationFunction()</a> is responsible for handling the incoming uMessages. <br  />
 It starts uTasks and send them other data if needed. <br  />
 It can add or delete commands to/from command list. <br  />
 It creates the response message and place it in to the outgoing buffer. <br  />
 <b>Outgoing Message Handler</b> <br  />
 found at <a class="el" href="d1/dc1/a00092.html#a29c46c562c76c3065fcde3e645f31556" title="Thread function prototype for sending out the uMessages and DebugMessages.">urabrosMessageSenderFunction()</a> handles the outgoing messages. <br  />
 uMessages are the topp priority, if there are no more uMessage to be send than, it can send out ASCII debug messages if there are some in the buffer. <br  />
 <b>Update Task List</b> <br  />
 found at <a class="el" href="d1/dc1/a00092.html#a8278811f4f69e804cb0de602bf44d7aa" title="Thread function prototype for updating the command statuses, depending on the uTasks statuses.">urabrosLogicControlFunction()</a> it updates the statuses in the commandlist, depending on the acttive uTasks's statuses. </p><hr  />
 <h2><a class="anchor" id="step3"></a>
uTask</h2>
<p><img src="Urabros_uTask.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> More detailed description at: <a class="el" href="d0/dc2/a00104.html" title="This header file contains the main functions an Urabros_TaskTypeDef has.  Include this header to a Ta...">UrabrosTask.h</a> <br  />
 Abstraction layer for a well described process. Forexample on a vending machine: give me one bottle. <br  />
 It has at least one FreeRTOS thread, but it can handle more than one. <br  />
 It has two tpes see here: <a class="el" href="dd/d32/a00041.html#a286a6325cad120110bace0a19775783e" title="An enum for descibing the mode of the given task.">Urabros_TaskMode</a> <br  />
 It can use uDrivers, dont use Low level acces things in uTask it is designed to be a high level process descriptor. </p><hr  />
 <h2><a class="anchor" id="step4"></a>
uDriver</h2>
<p><img src="Urabros_uDriver.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> More detailed description at: <a class="el" href="d6/d2d/a00047.html" title="This header file will give the uDriver it&#39;s functions and other important fields. Include this header...">UrabrosDriver.h</a> <br  />
 It contains a high level functions for a Hardware group, what has a well described process. <br  />
 For example a conveyor has some stepper motors and some sensors. And a driver for this conveyor could have a function like: bringStuff(num of stuffs) <br  />
 Than the caller enviroment dont have to mess with the low level HAL functions. <br  />
 Multiple uTasks cna use the smae uDriver, but it has a mutex to ensure the thread safety. </p><hr  />
 <h2><a class="anchor" id="step5"></a>
CommandList and TaskList</h2>
<p><img src="Urabros_CommandList.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> More detailed description at: <a class="el" href="de/de1/a00065.html" title="Command handle is one of the key part of the frimware.">uCommandHandler.h</a> <br  />
 There are two important Arrays from the communication view. One is shared between the PC and the MC we call it commandList. <a class="el" href="de/de1/a00065.html#ae72153bc45f0370f02ca97498b83e271" title="Array of commands, the maximum number.">uCommandList</a> <br  />
 The other one is for collecting all the uTasks we call it TaskList. <a class="el" href="d1/dc1/a00092.html#ae4ff553fc4f874df109767923030b3cf" title="This variable holds all of the Urabros_TaskPtrTypeDef pointers, whom are pointing to all the uTasks.">uTasks</a> <br  />
 The TaskList holds all the task pointers and it is refreshed by the <a class="el" href="d1/dc1/a00092.html#a8278811f4f69e804cb0de602bf44d7aa" title="Thread function prototype for updating the command statuses, depending on the uTasks statuses.">urabrosLogicControlFunction()</a>. <br  />
 The commandList holds all actie tasks and it's statuses. The status is separated to two parts main: 3 bit and minor:5bit see at: <a class="el" href="d4/d81/a00110.html">Urabros_CommandStatusTypeDef</a> <br  />
 The main status can be on;y predefined values with predefined meanings: <a class="el" href="dd/d32/a00041.html#a8ca18faa4e6cf3d767cb884b38c2b03c" title="An enum for describing the current status of a uTask.">Urabros_TaskStatusTypeDef</a> minor can be 0 - 31 and its meaning is different for each uTasks. </p><hr  />
 <h2><a class="anchor" id="step6"></a>
Master to Slave protocol</h2>
<p><img src="Urabros_ProtocoPcMc.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> Communication protocol for the PC --&gt; MC communication part. <br  />
 Starts with a message length it is 1 byte long so the maximum size is 255. If it is necesary it can be modified to 2 byte. <br  />
 Than following is the Data, where the first byte is the Command Type, IDs can be found here: <a class="el" href="dd/d32/a00041.html#a7cbbd97ccde7b8d11e24613e1bdd0ad8" title="An enum for the Command IDs.">Urabros_CommandType</a>. <br  />
 The second byte of the data usually is the uTasks ID, it is created by the Architect: #Urabros_CommandIdTypedef <br  />
 The last two bytes are the 16 bit CRC code. </p><hr  />
 <h2><a class="anchor" id="step7"></a>
Slave to Master protocol</h2>
<p><img src="Urabros_ProtocoMcPc.png" alt="" align="left" class="inline"/></p><div style="clear: both"></div><p> Communication protocol for the MC --&gt; PC communication part. <br  />
 It has two different types, the one is kinda similar to the PC--&gt;MC part the other one is the ASCII debug messages. The first byte is identify what kind of message will arrive. 0x02 for debug and 0xff for uMessage type. At the comerical message the second byte is the length of the data, than comes the data than the crc code. At the debug message, from second to n bytes are ASCII characters than at the end 0x03 end of text byte</p>
<h1><a class="anchor" id="install_sec"></a>
Installation</h1>
<p>Currently there are no installers and guides for this project. <br  />
 Only one distribution exists and it is for STM32H743ZG. <br  />
 There is a plan for make 3 different distribution for 3 different processors. <br  />
 Also there was a plan to make a python script what can generate the root fo the project by its configuration files. <br  />
</p>
<h1><a class="anchor" id="Links"></a>
Links</h1>
<p>GitLab can be found here: <a href="https://gitlab.com/mechatromotive/stm_alapproject/urabrosbase">https://gitlab.com/mechatromotive/stm_alapproject/urabrosbase</a> <br  />
GitLab link for Tester Software: <a href="https://gitlab.com/mechatromotive/stm_alapproject/urabrospctester">https://gitlab.com/mechatromotive/stm_alapproject/urabrospctester</a> <br  />
A presentation can be found here: <a href="https://docs.google.com/presentation/d/11Pq8FH_6TniGk-a71UukzcWwtIFbn8kGXkAyz0OQdaM/edit?usp=sharing">https://docs.google.com/presentation/d/11Pq8FH_6TniGk-a71UukzcWwtIFbn8kGXkAyz0OQdaM/edit?usp=sharing</a> <br  />
Teaching video materials can be found here: <a href="https://drive.google.com/drive/folders/1AwxLzu131hiJ3a7aJf_DGWWKowJSSK9-">https://drive.google.com/drive/folders/1AwxLzu131hiJ3a7aJf_DGWWKowJSSK9-</a> <br  />
Last updated documentation link: <a href="https://mechatromotive.gitlab.io/stm_alapproject/urabrosbase/">https://mechatromotive.gitlab.io/stm_alapproject/urabrosbase/</a> <br  />
Git Branching strategy: <a href="https://docs.google.com/document/d/1tIOLicInT9hC2rb7sQhW4ad07fyY0dUoD0kYspKARX4/edit?usp=sharing">https://docs.google.com/document/d/1tIOLicInT9hC2rb7sQhW4ad07fyY0dUoD0kYspKARX4/edit?usp=sharing</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
